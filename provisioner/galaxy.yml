#!/usr/bin/env ansible-playbook

- name: Solve Galaxy dependencies
  hosts: localhost
  connection: local
  gather_facts: false
  tasks:
    - name: detect requirements.yml
      stat:
        path: ./roles/requirements.yml
      register: doesRequirementsExist

    - name: fetch galaxy roles from requirements.yml
      command: ansible-galaxy install -r requirements.yml -p .
      args:
        chdir: "./roles"
      register: galaxy_result
      when: doesRequirementsExist.stat.exists
      changed_when: "'was installed successfully' in galaxy_result.stdout"

    - name: fetch galaxy roles from requirements.yml (forced update)
      command: ansible-galaxy install -r requirements.yml -p . --force
      args:
        chdir: "./roles"
      when: doesRequirementsExist.stat.exists
