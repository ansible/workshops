#### CHECK POINT AMI
- name: BLOCK FOR SPLUNK AMI
  block:
  - name: find ami for splunk
    ec2_ami_facts:
      region: "us-east-1" # I don't know why but that seems to be the only place it's available
      owners: "{{ ec2_info['splunk_enterprise']['owners'] }}"
      filters:
        name: "{{ ec2_info['splunk_enterprise']['filter'] }}"
        architecture: "{{ ec2_info['splunk_enterprise']['architecture'] }}"
    register: amis

  - name: save ami for splunk
    set_fact:
      splunk_ami: >
        {{ amis['images'] | selectattr('name', 'defined') | sort(attribute='creation_date') | last }}

- name: BLOCK FOR SNORT AMI
  block:
  - name: find ami for snort
    ec2_ami_facts:
      region: "{{ ec2_region }}"
      owners: "{{ ec2_info['rhel7']['owners'] }}"
      filters:
        name: "{{ ec2_info['rhel7']['filter'] }}"
        architecture: "{{ ec2_info['rhel7']['architecture'] }}"
    register: amis
   
  - name: save ami for snort
    set_fact:
      snort_ami: >
        {{ amis['images'] | selectattr('name', 'defined') | sort(attribute='creation_date') | last }}

- name: BLOCK FOR CHECK POINT AMI
  block:
  - name: find ami for check point management server (SECURITY MODE)
    ec2_ami_facts:
      region: "{{ ec2_region }}"
      owners: "679593333241"
      filters:
        name: "Check Point CloudGuard IaaS*PAYG-MGMT*R80.20*"
        architecture: "x86_64"
    register: checkpoint_mgmt_ami_list

  - name: save ami for check point management server (SECURITY MODE)
    set_fact:
      checkpoint_mgmt_ami: >
        {{ checkpoint_mgmt_ami_list.images | selectattr('name', 'defined') | sort(attribute='creation_date') | last }}
      
  - name: find ami for check point gateway (SECURITY MODE)
    ec2_ami_facts:
      region: "{{ ec2_region }}"
      owners: "679593333241"
      filters:
        name: "Check Point CloudGuard IaaS GW*PAYG-NGTX*R80.20*"
        architecture: "x86_64"
    register: checkpoint_gw_ami_list

  - name: save ami for check point gw (SECURITY MODE)
    set_fact:
      checkpoint_gw_ami: >
        {{ checkpoint_gw_ami_list.images | selectattr('name', 'defined') | sort(attribute='creation_date') | last }}
